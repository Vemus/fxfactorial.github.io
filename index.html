<!doctype html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Personal blog of Edgar Aroutiounian">
    <meta name="author" content="Edgar Aroutiounian">
    <title>hyegar.com - Home</title>
    <link rel="canonical" href="http://hyegar.com">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="./css/main.css">
    <link href="./atom.xml" rel="alternate" title="hyegar.com - A personal and developer blog" type="application/atom+xml">
    <link type="text/plain" rel="author" href="./humans.txt">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-57031124-1', 'auto');
      ga('send', 'pageview');
    </script>

  </head>

  <body>
    <header id="page_header">
    <h1><a href="./" title="Home">Edgar Aroutiounian</a></h1>
</header>

    <nav id="page_navigation">
    <ul>
        <li><a href="./">Home</a></li>
        <li><a href="./about">About</a></li>
        <li><a href="./archive">Archive</a></li>
        <li><a href="./notes">Notes</a></li>
        <li><a href="./talks">Talks</a></li>
    </ul>
</nav>

    
    <section id="content">
      <article>
    <header>
        <h1>
            <a href="./2016/05/21/using-lwt-preemptive/" title="Permalink">
                Using system threads with Lwt
            </a>
        </h1>
        <span class="post-date">May 21, 2016</span> in 
        <span class="post-tags"><a href="./tags/ocaml/">ocaml</a>, <a href="./tags/lwt/">lwt</a>, <a href="./tags/threading/">threading</a></span>
    </header>
    <p>This blog post shows you how to use real system threads in OCaml by using <code>Lwt</code>, <code>Lwt_preemptive</code>.</p>
<h1 id="common-complaint-about-multicore">Common complaint about multicore</h1>
<p>A common complaint about OCaml is the lack of multicore, about the single threadedness of the runtime. This is true but its not like <code>OCaml</code> programmers don’t have solutions! Here’s an easy example that you can instantly use in your coding.</p>
<h1 id="setup">Setup</h1>
<p>First we will need some way to verify that our system threads are actually working, we’ll use some math equation to purposefully cause CPU load. Here’s the <code>Sieve Of Eratosthenes</code> Algorithm that I copied from <a href="http://www.scriptol.com/programming/sieve.php#ocaml">here</a>.</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="ot">open</span> List

<span class="kw">type</span> integer = <span class="dt">Int</span> <span class="kw">of</span> <span class="dt">int</span>
<span class="kw">let</span> number_two = <span class="dt">Int</span>(<span class="dv">2</span>)
<span class="kw">let</span> number_zero = <span class="dt">Int</span>(<span class="dv">0</span>)
<span class="kw">let</span> is_less_than_two (<span class="dt">Int</span> n) = n &lt; <span class="dv">2</span>
<span class="kw">let</span> incr (<span class="dt">Int</span> n) = <span class="dt">Int</span>(n + <span class="dv">1</span>)
<span class="kw">let</span> decr (<span class="dt">Int</span> n) = <span class="dt">Int</span>(n - <span class="dv">1</span>)
<span class="kw">let</span> is_number_zero (<span class="dt">Int</span> n) = n = <span class="dv">0</span>

<span class="kw">let</span> iota n =
  <span class="kw">let</span> <span class="kw">rec</span> loop curr counter =
    <span class="kw">if</span> is_less_than_two counter <span class="kw">then</span> []
    <span class="kw">else</span> curr::(loop (incr curr) (decr counter))
  <span class="kw">in</span>
  loop number_two n

<span class="kw">let</span> sieve lst =
  <span class="kw">let</span> <span class="kw">rec</span> choose_pivot = <span class="kw">function</span>
    | [] -&gt; []
    | car::cdr <span class="kw">when</span> is_number_zero car -&gt;
      car::(choose_pivot cdr)
    | car::cdr -&gt;
      car::(choose_pivot (do_sieve car (decr car) cdr))

  <span class="kw">and</span> do_sieve step current lst =
    <span class="kw">match</span> lst <span class="kw">with</span>
    | [] -&gt; []
    | car::cdr -&gt;
      <span class="kw">if</span> is_number_zero current
      <span class="kw">then</span> number_zero::(do_sieve step (decr step) cdr)
      <span class="kw">else</span> car::(do_sieve step (decr current) cdr)
  <span class="kw">in</span>
  choose_pivot lst

<span class="kw">let</span> is_prime n =
  <span class="kw">match</span> rev (sieve (iota n)) <span class="kw">with</span>
    x::_ -&gt; not (is_number_zero x)</code></pre></div>
<p>Now our <code>Lwt</code>, <code>Lwt_preemptive</code> code:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="ot">open</span> Lwt<span class="kw">.</span>Infix

<span class="kw">let</span> do_example port =
  <span class="kw">let</span> address = Unix<span class="kw">.</span>(<span class="dt">ADDR_INET</span> (inet_addr_loopback, port)) <span class="kw">in</span>
  Lwt_io<span class="kw">.</span>establish_server address (<span class="kw">fun</span> (tcp_in, tcp_out) -&gt;
      () |&gt; Lwt_preemptive<span class="kw">.</span>detach (<span class="kw">fun</span> () -&gt;
          <span class="kw">while</span> <span class="kw">true</span> <span class="kw">do</span>
            ignore (is_prime (<span class="dt">Int</span> port))
          <span class="kw">done</span>
        )
      |&gt; Lwt<span class="kw">.</span>ignore_result
    )
  |&gt; ignore |&gt; Lwt<span class="kw">.</span>return

<span class="kw">let</span> () =
  <span class="kw">let</span> <span class="kw">rec</span> forever () = fst (Lwt<span class="kw">.</span>wait ()) &gt;&gt;= forever <span class="kw">in</span>
  Lwt_preemptive<span class="kw">.</span>init <span class="dv">5</span> <span class="dv">10</span> ignore;
  ([<span class="dv">2000</span>; <span class="dv">2001</span>; <span class="dv">2002</span>; <span class="dv">2003</span>; <span class="dv">2004</span>]
   |&gt; Lwt_list<span class="kw">.</span>iter_p do_example &gt;&gt;= forever)
  |&gt; Lwt_main<span class="kw">.</span>run</code></pre></div>
<p>The code that runs inside the callback to <code>Lwt_io.establish_server</code> uses <code>Lwt_preemptive.detach</code>, this creates a new system thread whenever there is something that connects on ports <code>[2000; 2001; 2002; 2003; 2004]</code>. You don’t have to call <code>Lwt_preemptive.init</code> since detach will do it anyway, but I am doing it to ensure that at least 5 threads are made with 10 being the max.</p>
<p>We compile it with:</p>
<pre class="shell"><code>$ ocamlfind ocamlopt -thread -package lwt.unix,lwt.preemptive test_case.ml -linkpkg -o TEST_CASE</code></pre>
<p>And we test it by starting up <code>./TEST_CASE</code>, opening <code>htop</code> and finding <code>TEST_CASE</code> (hit <code>t</code> in htop to see a tree based process view) and running <code>socat STDIN TCP:localhost:&lt;some_port&gt;</code>, where <code>&lt;some_port&gt;</code> is a number in our list of ports (remember <code>[2000; 2001; 2002; 2003; 2004]</code>).</p>
<p>Thus we see in <code>htop</code> the CPU % utilization move for each of the threads of <code>TEST_CASE</code>.</p>
<p>Success! Real system threads.</p>
</article>
<article>
    <header>
        <h1>
            <a href="./2016/03/22/simple-timeouts/" title="Permalink">
                Simple timeout usage
            </a>
        </h1>
        <span class="post-date">March 22, 2016</span> in 
        <span class="post-tags"><a href="./tags/ocaml/">ocaml</a>, <a href="./tags/unix/">unix</a>, <a href="./tags/timeout/">timeout</a></span>
    </header>
    <p>I wanted to use a timeout in OCaml for some shell coding but I didn’t want to introduce a big dependency on <code>Lwt</code>. After some googling I found <a href="https://www.reddit.com/r/ocaml/comments/3qapbv/question_about_writing_a_timeout_function_and_the/">this</a></p>
<p>Here’s my take on the timeout function, basically its the same but I push everything into the timeout function itself and use labeled args along a callback for when the timeout goes off.</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">let</span> timeout ?(on_timeout = <span class="kw">fun</span> () -&gt; ()) ~arg ~timeout ~default_value f =
  <span class="kw">let</span> <span class="ot">module</span> Wrapper = <span class="kw">struct</span> <span class="kw">exception</span> <span class="dt">Timeout</span> <span class="kw">end</span> <span class="kw">in</span>
  <span class="kw">let</span> sigalrm_handler = Sys<span class="kw">.</span><span class="dt">Signal_handle</span> (<span class="kw">fun</span> _ -&gt; raise Wrapper<span class="kw">.</span><span class="dt">Timeout</span>) <span class="kw">in</span>
  <span class="kw">let</span> old_behavior = Sys<span class="kw">.</span>signal Sys<span class="kw">.</span>sigalrm sigalrm_handler <span class="kw">in</span>
  <span class="kw">let</span> reset_sigalrm () = Sys<span class="kw">.</span>set_signal Sys<span class="kw">.</span>sigalrm old_behavior <span class="kw">in</span>
  ignore (Unix<span class="kw">.</span>alarm timeout);
  <span class="kw">try</span>
    <span class="kw">let</span> res = f arg <span class="kw">in</span>
    reset_sigalrm ();
    res
  <span class="kw">with</span> exc -&gt;
    reset_sigalrm ();
    <span class="kw">if</span> exc = Wrapper<span class="kw">.</span><span class="dt">Timeout</span>
    <span class="kw">then</span> (on_timeout (); default_value)
    <span class="kw">else</span> raise exc</code></pre></div>
<p>and you can can use it like so:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml">Sys<span class="kw">.</span>command
|&gt; timeout 
   ~arg:<span class="st">&quot;sleep 3&quot;</span> 
   ~timeout:<span class="dv">2</span> 
   ~default_value:(<span class="dv">-1</span>) 
   ~on_timeout:(<span class="kw">fun</span> () -&gt; print_endline <span class="st">&quot;func timed out&quot;</span>)</code></pre></div>
<p>You might notice that your wrapped function only gets one arg, so how can we use this timeout wrapper on functions that take more than one argument? By currying and using a dummy arg of unit.</p>
<p>Example:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">let</span> () =
  <span class="kw">let</span> partialed first second third () = first + second + third <span class="kw">in</span>
  timeout ~arg:() ~timeout:<span class="dv">4</span> ~default_value:(<span class="dv">-1</span>) (partialed <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span>)
  |&gt; ignore</code></pre></div>
<p>I’ve added this to my <code>podge</code> library found <a href="http://github.com/fxfactorial/podge">here</a>, a collection of useful utility functions.</p>
</article>
<article>
    <header>
        <h1>
            <a href="./2016/03/15/building-xen-arm-from-source/" title="Permalink">
                Building xen-arm-builder from source
            </a>
        </h1>
        <span class="post-date">March 15, 2016</span> in 
        <span class="post-tags"><a href="./tags/mirageos/">mirageos</a>, <a href="./tags/sdcard/">sdcard</a>, <a href="./tags/xen/">xen</a>, <a href="./tags/ocaml/">ocaml</a></span>
    </header>
    <p>I’m in Morocco for the first <a href="http://marrakech2016.mirage.io/">mirageos</a> hackathon. One of the things I’ve done here is build <a href="https://github.com/mirage/xen-arm-builder">xen-arm-builder</a> from source and it was a big challenge. Here’s my general notes and pointers to help you get over this hump. I assume you know what mirageos/xen are.</p>
<p>Much MUCH thanks to <a href="http://roscidus.com/blog/">Thomas Leonard</a> and <a href="http://somerandomidiot.com/">Mindy Preston</a> for lending me a cubieboard2 and helping me with all the debugging, compiling issues; wouldn’t have been able to do it without them.</p>
<h1 id="machine-setup">Machine Setup</h1>
<p>I did this on Ubuntu 15 and was deploying to a <a href="http://cubieboard.org/2013/06/19/cubieboard2-is-here/">cubieboard2</a>.</p>
<h1 id="example-workflow">Example Workflow</h1>
<p>Assuming that you are connecting the cubieboard2 to your laptop over a serial connection then you can get a shell on the machine with</p>
<pre class="shell"><code>$ screen -h 10000 /dev/ttyUSB0 115200</code></pre>
<p>Then say you are using <a href="https://github.com/mirage/mirage-skeleton">mirage-skeleton</a>, here’s an example flow.</p>
<pre class="shell"><code>$ git clone https://github.com/mirage/mirage-skeleton
$ cd mirage-skeleton
$ make configure MODE=xen
$ cd console
$ make
$ sudo xl create console.xe</code></pre>
<p>Yay Unikernel on Cubieboard2!</p>
<h1 id="troublesome-issues">Troublesome issues</h1>
<p>I had many, many issues in building the code from source, here are some troubleshooting steps that might help you as well.</p>
<ol start="0" style="list-style-type: decimal">
<li>Be sure to have fast internet because building from source including making a clone of the Linux source, ouch.</li>
<li><code>OPAMVERBOSE=1 opam &lt;anything&gt;</code> is incredibly useful.</li>
<li>Ubuntu 15 will install a <code>gcc-5.0</code> version of the cross-compiler, be sure to do <code>make build CC=arm-linux-gnueabihf-gcc-4.8</code> instead of a plain <code>make build</code>.</li>
<li>Be sure to <strong>not</strong> use the <code>4.02.0</code> compiler, the cubieboard2 is super slow and that OCaml compiler had a performance bug, use the <code>4.02.3</code> compiler instead.</li>
<li>Check <code>top</code> to see some kind of xp binary, it eats the CPU and that really slows down compilation, best to kill them.</li>
<li>Do make sure that the time on the machine is correct, otherwise you’ll have weird hanging by opam which will seem like its building but actually its just stuck on a timing issue, aka be sure to do: <code>sudo ntpdate uk.pool.ntp.org</code> before doing anything with mirage/opam/aptitude.</li>
<li>If you get odd errors like:</li>
</ol>
<pre class="shell"><code>Parsing config from console.xl
xc: error: panic: xc_dom_core.c:185: failed to open file: No such file or directory: Internal error
libxl: error: libxl_dom.c:377:libxl__build_pv: xc_dom_kernel_file failed: No such file or directory
libxl: error: libxl_create.c:1022:domcreate_rebuild_done: cannot
(re-)build domain: -3</code></pre>
<p>Then check that the libraries are correctly set in <code>/usr/lib</code>, check with</p>
<pre class="shell"><code>$ sudo strace -e open xl create console.xl</code></pre>
<p>and either <code>cp</code> or <code>ln</code> them correctly.</p>
<ol start="7" style="list-style-type: decimal">
<li>I recommend just installing all the <code>depopts</code> of all the mirage projects, there are some bugs in mirage opam files that don’t install other needed packages.</li>
</ol>
</article>
<article>
    <header>
        <h1>
            <a href="./2016/03/07/dga-padcrypt-ocaml/" title="Permalink">
                A Domain Generating Algorithm in OCaml
            </a>
        </h1>
        <span class="post-date">March  7, 2016</span> in 
        <span class="post-tags"><a href="./tags/ocaml/">ocaml</a>, <a href="./tags/dga/">dga</a>, <a href="./tags/padcrypt/">padcrypt</a></span>
    </header>
    <p>Scrolling through twitter I saw someone mention something about the padcrypt <a href="https://en.wikipedia.org/wiki/Domain_generation_algorithm">dga</a>. Basically it generates random ish domain names.</p>
<p>Here’s an <code>OCaml</code> reimplementation of the Python code written <a href="http://johannesbader.ch/2016/03/the-dga-of-padcrypt/">here</a>.</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="ot">module</span> D = CalendarLib<span class="kw">.</span><span class="dt">Date</span>

<span class="kw">let</span> tlds = [|<span class="st">&quot;com&quot;</span>;<span class="st">&quot;co.uk&quot;</span>; <span class="st">&quot;de&quot;</span>;<span class="st">&quot;org&quot;</span>;<span class="st">&quot;net&quot;</span>;<span class="st">&quot;eu&quot;</span>;<span class="st">&quot;info&quot;</span>;<span class="st">&quot;online&quot;</span>;
            <span class="st">&quot;co&quot;</span>; <span class="st">&quot;cc&quot;</span>; <span class="st">&quot;website&quot;</span>|]

<span class="kw">let</span> tlds_count = Array<span class="kw">.</span>length tlds
<span class="kw">let</span> nr_domains = <span class="dv">24</span> * <span class="dv">3</span>
<span class="kw">let</span> digit_mapping = <span class="st">&quot;abcdnfolmk&quot;</span>

<span class="kw">let</span> seed_string ~date i =
  Printf<span class="kw">.</span>sprintf <span class="st">&quot;%d-%d-%d|%d&quot;</span>
    (D<span class="kw">.</span>day_of_month date)
    (D<span class="kw">.</span>month date |&gt; D<span class="kw">.</span>int_of_month)
    (D<span class="kw">.</span>year date)
    i

<span class="kw">let</span> domain_generate date =
  <span class="kw">let</span> <span class="kw">rec</span> helper count accum =
    <span class="kw">if</span> count = nr_domains <span class="kw">then</span> accum
    <span class="kw">else</span> seed_string ~date count :: helper (count + <span class="dv">1</span>) accum
  <span class="kw">in</span>
  helper <span class="dv">0</span> []

<span class="kw">let</span> () =
  Nocrypto_entropy_unix<span class="kw">.</span>initialize ();
  CalendarLib<span class="kw">.</span>Date<span class="kw">.</span>today ()
  |&gt; domain_generate
  |&gt; List<span class="kw">.</span>iter <span class="kw">begin</span> <span class="kw">fun</span> date_stamp -&gt;
    <span class="kw">let</span> hashed =
      (Cstruct<span class="kw">.</span>of_string date_stamp)
      |&gt; Nocrypto<span class="kw">.</span>Hash<span class="kw">.</span>digest <span class="dt">`SHA256</span>
      |&gt; Hex<span class="kw">.</span>of_cstruct |&gt; <span class="kw">function</span> <span class="dt">`Hex</span> s -&gt; s
    <span class="kw">in</span>
    <span class="kw">let</span> domain =
      String<span class="kw">.</span>sub hashed <span class="dv">3</span> <span class="dv">16</span>
      |&gt; Stringext<span class="kw">.</span>to_list
      |&gt; List<span class="kw">.</span>map
        (<span class="kw">function</span> <span class="ch">'0'</span>..<span class="ch">'9'</span> <span class="kw">as</span> hh -&gt;
          Char<span class="kw">.</span>code hh - <span class="dv">48</span> |&gt; String<span class="kw">.</span>get digit_mapping
                | o -&gt; o)
      |&gt; Stringext<span class="kw">.</span>of_list
    <span class="kw">in</span>
    <span class="kw">let</span> tld_index =
      String<span class="kw">.</span>get hashed (String<span class="kw">.</span>length hashed - <span class="dv">1</span>)
      |&gt; Printf<span class="kw">.</span>sprintf <span class="st">&quot;0x%c&quot;</span>
      |&gt; int_of_string
      |&gt; <span class="kw">fun</span> tld -&gt; <span class="kw">if</span> tld &gt;= tlds_count <span class="kw">then</span> <span class="dv">0</span> <span class="kw">else</span> tld
    <span class="kw">in</span>
    Printf<span class="kw">.</span>sprintf <span class="st">&quot;%s.%s&quot;</span> domain (Array<span class="kw">.</span>get tlds tld_index)
    |&gt; print_endline
  <span class="kw">end</span></code></pre></div>
<p>You can build it with a simple <code>Makefile</code> like this:</p>
<div class="sourceCode"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span class="dv">all:</span>
	ocamlfind ocamlopt main.ml <span class="ch">\</span>
	<span class="ch">-</span><span class="fu">package nocrypto.unix,calendar,hex,stringext </span><span class="ch">\</span>
<span class="fu">	-linkpkg -o Dga</span></code></pre></div>
<p>and here’s a sample output:</p>
<pre class="text"><code>&gt; ./Dga 
...
abbdddmfllkbamco.com
fbfknncbfcbbmlde.website
flcfcbaocdmbfbmb.website
mkaakfkaoocealda.com
doabakblkbaffmnd.cc
llacffaobdcodbca.com
fcdebfefakffamco.co
dbbbenbaalcbkbnl.com
dkomadcbodnamfbb.com
aanamlbblmaefofc.org</code></pre>
<p>For reference the github repo is <a href="https://github.com/fxfactorial/dga-padcrypt-ocaml">here</a>.</p>
</article>
<article>
    <header>
        <h1>
            <a href="./2016/03/06/get-date-string-in-ocaml/" title="Permalink">
                Date formating + hash digest example in OCaml
            </a>
        </h1>
        <span class="post-date">March  6, 2016</span> in 
        <span class="post-tags"><a href="./tags/ocaml/">ocaml</a>, <a href="./tags/datetime/">datetime</a>, <a href="./tags/date/">date</a>, <a href="./tags/crypto/">crypto</a>, <a href="./tags/nocrypto/">nocrypto</a></span>
    </header>
    <p>This is another blog post in my quest to improve the state of OCaml coding for the average programmer. Today’s blog post is getting a date string in OCaml, a seemingly trivial thing to do in many other programming languages, and using it in a real world hashing example.</p>
<h1 id="low-level-way">Low level way</h1>
<p>You do could it like this:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="co">(* Assume this is code.ml *)</span>
<span class="kw">let</span> time_now () =
  Unix<span class="kw">.</span>(
    <span class="kw">let</span> localtime = localtime (time ()) <span class="kw">in</span>
    Printf<span class="kw">.</span>sprintf <span class="st">&quot;[%02u:%02u:%02u]&quot;</span>
      localtime.tm_hour localtime.tm_min localtime.tm_sec)
	  
<span class="kw">let</span> () = time_now () |&gt; print_endline</code></pre></div>
<p>This will require you to link the <code>unix</code> package against your program, for example:</p>
<pre class="shell"><code>$ ocamlfind ocamlopt -package unix -linkpkg code.ml -o Time_now</code></pre>
<h1 id="higher-level-way-crypto-example">Higher level way + Crypto example</h1>
<p>At some point this low level interface might not be appropriate and you’ll want higher abstracts. <code>Calendar</code> is an package on opam that provides such abstractions; install with:</p>
<pre class="shell"><code>$ opam install calendar</code></pre>
<p>The API of <code>calendar</code>, which you’ll find under the module <code>CalendarLib</code>, is rather large. Here’s some real world code that you can reuse, built upon. The example also uses a cryptographic package which you can get with</p>
<pre class="shell"><code>$ opam install nocrypto</code></pre>
<p>and the code:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="co">(* Assume this is code.ml *)</span>
<span class="ot">module</span> D = CalendarLib<span class="kw">.</span><span class="dt">Date</span>

<span class="kw">let</span> nr_domains = <span class="dv">24</span>

<span class="kw">let</span> seed_string ~date i =
  Printf<span class="kw">.</span>sprintf
    <span class="st">&quot;%d-%d-%d:%d&quot;</span>
    (D<span class="kw">.</span>day_of_month date)
    (D<span class="kw">.</span>month date |&gt; D<span class="kw">.</span>int_of_month)
    (D<span class="kw">.</span>year date)
    i

<span class="kw">let</span> domain_generate date =
  <span class="kw">let</span> <span class="kw">rec</span> helper count accum =
    <span class="kw">if</span> count = nr_domains <span class="kw">then</span> accum
    <span class="kw">else</span> seed_string ~date count :: helper (count + <span class="dv">1</span>) accum
  <span class="kw">in</span>
  helper <span class="dv">0</span> []

<span class="kw">let</span> () =
  Nocrypto_entropy_unix<span class="kw">.</span>initialize ();
  CalendarLib<span class="kw">.</span>Date<span class="kw">.</span>today ()
  |&gt; domain_generate
  |&gt; List<span class="kw">.</span>iter <span class="kw">begin</span> <span class="kw">fun</span> date_stamp -&gt;
    Nocrypto<span class="kw">.</span>Hash<span class="kw">.</span>digest <span class="dt">`SHA256</span> (Cstruct<span class="kw">.</span>of_string date_stamp)
    |&gt; Cstruct<span class="kw">.</span>to_string |&gt; print_endline
  <span class="kw">end</span></code></pre></div>
<p>and compiling with:</p>
<pre class="shell"><code>$ ocamlfind ocamlopt -package calendar,nocrypto.unix -linkpkg code.ml -o Ex</code></pre>
<p>Yay. Be sure to check my archives for many more quick and useful posts on OCaml.</p>
</article>


<footer>
    See older posts in the <a href="./archive/">archive</a>
</footer>

    </section>

    <footer id="page_footer">
    <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC-4.0</a>
    &mdash;
    Built with 
    <a href="http://jaspervdj.be/hakyll">Hakyll</a>.
    &mdash;
    Source on 
    <a href="https://github.com/fxfactorial/hblog">GitHub</a>
    &mdash;
    <a href="http://hyegar.com/atom.xml">RSS feed</a>
</footer>

  </body>
</html>
