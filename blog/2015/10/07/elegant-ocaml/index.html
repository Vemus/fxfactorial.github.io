<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Elegant OCaml - Edgar Aroutiounian</title>
    <meta charset="utf-8" />
    <meta name="author" content="Edgar Aroutiounian" />
    <meta name="description" content="Nice code" />
    <meta name="keywords" content="functional, programming" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
    <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  </head>
  <body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">Edgar Aroutiounian</a></h1>
        <p>Thoughts and Musings</p>
        <ul>
          <li><a href="/ocamldocs/">Ocamldocs</a></li>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="http://github.com/fxfactorial">GitHub</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="hyegar.com">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1>Elegant OCaml</h1>
<p>
I love elegant code, code that just flows and lets you "see" how the
data moves through execution. As part of my <a href="https://github.com/fxfactorial/brozip">brozip</a> application, I
wanted to give the feature of recursively compressing or decompressing
a directory. So I just wrote exactly what came to mind and came up
with this
</p>
<div class="org-src-container">

<pre class="src src-ocaml">let rec walk_and_action action node =
  if Sys.is_directory node
  then (Sys.readdir node
        |&gt; Array.to_list
        |&gt; List.map (Filename.concat node)
        |&gt; Lwt_list.iter_p (walk_and_action action))
  else action node
</pre>
</div>
<p>
Where <code>action</code> has type: <code>string -&gt; unit Lwt.t</code> (a function that takes
a <code>string</code> and returns <code>unit Lwt.t</code>) and <code>node</code> is just a <code>string</code> for
the file name.
Translating the code into English, we first check if the file name
represents a directory, if its a directory then we 
</p>

<blockquote>
<ol class="org-ol">
<li>Read the directory's contents</li>
<li>Convert the returned array into a list</li>
<li>Use a partially evaluated function, <code>Filename.concat node</code> and
finish that computation for each of the file names in the list</li>
<li>Use correct concatenated strings to feed to <code>Lwt_list.iter_p</code> which
will call the partially evaluated function <code>walk_and_action action</code>
on each of the files. The <code>iter_p</code> function tells us that it will
call its given function concurrently, which is very nice.</li>
</ol>
</blockquote>

<p>
If its not a directory then we just call the function for the given
file.
</p>

<p>
Notice how elegant this code is, the whole function body is just one
expression and the data just flows from the output of one function as
the input of the other, there's no separation between the function
calls.
</p>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2015-10-07</span>
        <span title="last modification date" class="post-info">2015-10-07</span>
        <span title="tags" class="post-info"><a href="/tags/functional/">functional</a>, <a href="/tags/programming/">programming</a></span>
        <span title="author" class="post-info">Edgar Aroutiounian</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/2015/10/07/elegant-ocaml";
          var disqus_url = "http://hyegar.com/blog/2015/10/07/elegant-ocaml";
          var disqus_shortname = 'hyegar';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </section>
      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-57031124-1']);
        _gaq.push(['_trackPageview']);
        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x (<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:edgar &lt;dot&gt; factorial &lt;at&gt; gmail &lt;dot&gt; com">Edgar Aroutiounian</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
