<!DOCTYPE html>
<html lang="en-us">
<head>
  <title>Elegant OCaml - Edgar Aroutiounian</title>
  <meta charset="utf-8" />
  <meta name="author" content="Edgar Aroutiounian" />
  <meta name="description" content="Nice code" />
  <meta name="keywords" content="functional, programming" />

  <link rel="alternate" title="RSS Feed" href="/rss.xml" type="application/rss+xml">

  <link rel="stylesheet" href="/media/css/main.css" type="text/css">
  <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
</head>

  <body class="container">
<header id="header">
  <h1 class="title"><a href="/">Edgar Aroutiounian</a></h1>
  <ul>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/tags/">Tags</a></li>
    <li><a href="/about/">About</a></li>
  </ul>
  <form method="get" id="search" action="https://duckduckgo.com">
    <input type="text" class="field" name="q" id="s" placeholder="Search">
    <input type="hidden" name="as_sitesearch" value="hyegar.com">
  </form>
</header>

<section id="content" role="main">
  <h1>Elegant OCaml</h1>
  <p>
I love elegant code, code that just flows and lets you "see" how the
data moves through execution. As part of my <a href="https://github.com/fxfactorial/brozip">brozip</a> application, I
wanted to give the feature of recursively compressing or decompressing
a directory. So I just wrote exactly what came to mind and came up
with this
</p>
<div class="org-src-container">

<pre class="src src-ocaml">let rec walk_and_action action node =
  if Sys.is_directory node
  then (Sys.readdir node
        |&gt; Array.to_list
        |&gt; List.map (Filename.concat node)
        |&gt; Lwt_list.iter_p (walk_and_action action))
  else action node
</pre>
</div>
<p>
Where <code>action</code> has type: <code>string -&gt; unit Lwt.t</code> (a function that takes
a <code>string</code> and returns <code>unit Lwt.t</code>) and <code>node</code> is just a <code>string</code> for
the file name.
Translating the code into English, we first check if the file name
represents a directory, if its a directory then we 
</p>

<blockquote>
<ol class="org-ol">
<li>Read the directory's contents</li>
<li>Convert the returned array into a list</li>
<li>Use a partially evaluated function, <code>Filename.concat node</code> and
finish that computation for each of the file names in the list</li>
<li>Use correct concatenated strings to feed to <code>Lwt_list.iter_p</code> which
will call the partially evaluated function <code>walk_and_action action</code>
on each of the files. The <code>iter_p</code> function tells us that it will
call its given function concurrently, which is very nice.</li>
</ol>
</blockquote>

<p>
If its not a directory then we just call the function for the given
file.
</p>

<p>
Notice how elegant this code is, the whole function body is just one
expression and the data just flows from the output of one function as
the input of the other, there's no separation between the function
calls.
</p>

</section>



<footer id="footer">
    Send comments, critique and suggestions to <a href="mailto:edgar &lt;dot&gt; factorial &lt;at&gt; gmail &lt;dot&gt; com">Edgar Aroutiounian</a>.
    Powered by <a href="https://github.com/kelvinh/org-page">org-page</a>
</footer>

  </body>
</html>
