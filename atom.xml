<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:dc="http://purl.org/dc/elements/1.1/">
    <channel>
        <title>hyegar.com - All posts</title>
        <link>http://beancode.io</link>
        <description><![CDATA[Personal blog of Edgar Aroutiounian]]></description>
        <atom:link href="http://beancode.io/atom.xml" rel="self"
                   type="application/rss+xml" />
        <lastBuildDate>Sat, 23 Jan 2016 00:00:00 UT</lastBuildDate>
        <item>
    <title>2016-01-23-calling-ocaml-from-objective-c</title>
    <link>http://beancode.io/2016/01/23/calling-ocaml-from-objective-c/index.html</link>
    <description><![CDATA[<p>I love iOS and I love OCaml, so I’ve packaged up an OCaml compiler for iOS via opam. Now all you need to build OCaml programs on the iPhone is opam!</p>
<h1 id="first-steps">First steps</h1>
<p>You’ll need the cross compiler. Follow the README instructions mentioned <a href="https://github.com/fxfactorial/opam-ios">here</a>. This will provide you with the cross compiler based on OCaml 4.02.0.</p>
<h1 id="example-code">Example Code</h1>
<p>Now I’ll show you an example of calling OCaml from Objective-C. Much of this code will have simplifications as its an example for getting you started. Also note that dealing at the C level and the OCaml runtime can be tricky and is not for beginners.</p>
<p>Here’s the OCaml code first, assume it is named code.ml</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="dv">1</span>  <span class="kw">let</span> make_string () =
<span class="dv">2</span>    print_endline <span class="st">&quot;Hello Word from OCaml&quot;</span>;
<span class="dv">3</span>    <span class="st">&quot;Hello World &quot;</span>
<span class="dv">4</span>  
<span class="dv">5</span>  <span class="kw">let</span> () =
<span class="dv">6</span>    Callback<span class="kw">.</span>register <span class="st">&quot;make_string&quot;</span> make_string</code></pre></div>
<p>We’re essentially telling the runtime to make this function available to grab as a handle, in this case it’s a handle on a closure.</p>
<p>And now the Objective-C code, assume it is named main.c</p>
<div class="sourceCode"><pre class="sourceCode objectivec"><code class="sourceCode objectivec"> <span class="dv">1</span>  #define CAML_NAME_SPACE
 <span class="dv">2</span>  
 <span class="dv">3</span>  #import &lt;Foundation/Foundation.h&gt;
 <span class="dv">4</span>  
 <span class="dv">5</span>  #include &lt;caml/callback.h&gt;
 <span class="dv">6</span>  #include &lt;caml/mlvalues.h&gt;
 <span class="dv">7</span>  
 <span class="dv">8</span>  <span class="dt">int</span> main (<span class="dt">int</span> argc, <span class="dt">char</span> **argv)
 <span class="dv">9</span>  {
<span class="dv">10</span>    caml_startup(argv);
<span class="dv">11</span>    caml_callback(*caml_named_value(<span class="st">&quot;make_string&quot;</span>), Val_unit);
<span class="dv">12</span>    NSLog(<span class="st">@&quot;Now using objective-c code&quot;</span>);
<span class="dv">13</span>    <span class="kw">return</span> <span class="dv">0</span>;
<span class="dv">14</span>  }</code></pre></div>
<p>Its important to call <code>caml_startup</code> before any OCaml callbacks. Then we get a handle on the closure and call it with unit.</p>
<p>To compile this code you’ll need the cross-compiler which was installed by following the directions on my opam-ios repo, the command you use is:</p>
<pre class="shell"><code>$ ocamloptrev -rev 8.3 -ccopt -ObjC -cclib &#39;-framework Foundation&#39; main.c code.ml -o F</code></pre>
<p>The 8.3 is the iOS SDK you want to link against, again see the README on the github repo for opam-ios for more details.</p>
<p>The output we get, <code>F</code> is an arm executable, when we run it on the iPhone we will get an output of:</p>
<pre class="shell"><code>$ some_iphone :~/  ./F
Hello Word from OCaml
2016-01-23 22:44:04.889 F[1977:507] Now using objective-c code</code></pre>
<p>Yay!</p>]]></description>
    <pubDate>Sat, 23 Jan 2016 00:00:00 UT</pubDate>
    <guid>http://beancode.io/2016/01/23/calling-ocaml-from-objective-c/index.html</guid>
    <dc:creator>Edgar Aroutiounian</dc:creator>
</item>
<item>
    <title>2015-10-20-so-youre-learning-ocaml</title>
    <link>http://beancode.io/2015/10/20/so-youre-learning-ocaml/index.html</link>
    <description><![CDATA[<p>Today was the first day of the Introduction to Functional Programming in <code>OCaml</code> course, located <a href="https://www.france-universite-numerique-mooc.fr/courses/parisdiderot/56002/session01/about">here</a>. Apparently over 2,000 people signed up and while doubtlessly many will drop out, there will still be 2,000 more programmers that are now aware of this amazing language called <code>OCaml</code>.</p>
<h1 id="crash-course-on-the-ocaml-ecosystem.">Crash course on the OCaml ecosystem.</h1>
<p>These are some key notes that you should know.</p>
<ol style="list-style-type: decimal">
<li><p><code>opam</code> is the package manager for OCaml. It is very advanced and supports many features. The most basic of which is</p>
<pre class="shell"><code>$ opam install &lt;some_package&gt;</code></pre>
<p>For people on <code>OS X</code>, you can get it on <code>brew</code> and all the <code>Linux</code> distros should have <code>opam</code> for you to install. For Windows people, get a VM. EDIT: To be clear, OCaml can build <strong>native</strong> executables on Windows just fine, but opam doesn’t work on this platform and for a beginner you’ll waste a lot of time with environment issues or libraries that assume Unix.</p></li>
<li><p>Once you have <code>opam</code> installed, you probably want to do:</p>
<pre class="shell"><code>$ opam switch 4.02.3</code></pre>
<p>This will install the latest version of the compiler.</p></li>
<li><p><code>ocamlfind</code> is a program that predates <code>opam</code> and wraps the standard <code>OCaml</code> compilers: <code>ocamlc</code> and <code>ocamlopt</code>. The former is a byte code compiler and the latter creates native code.</p></li>
<li><p><code>ocamlbuild</code> is a tool that helps build <code>OCaml</code> programs, many people have strong opinions on it.</p></li>
<li><p><code>oasis</code> is a tool that helps abstract usage of 3, 4. I resisted it for a while and wrote Makefiles instead, don’t do that, just use oasis. The oasis flow basically goes like this: (Be aware that oasis is really finicky and its error messages are useless)</p>
<p>5.1) Create a directory.</p>
<p>5.2) Go to the directory and create a file named <strong>_oasis</strong> and directory named <code>src</code></p>
<p>5.3) Here is a template of the contents of the <strong>_oasis</strong> file</p>
<pre class="shell"><code>OASISFormat:  0.4
OCamlVersion: &gt;= 4.02.3
Name:         opam_package_name
Version:      0.1
Maintainers:  New OCaml programmer
Homepage:     http://my_coolsite.com
Synopsis:     Some short description
Authors:      Cool@me.com
License:      BSD-3-clause
Plugins:      META (0.4), DevFiles (0.4)
AlphaFeatures: ocamlbuild_more_args

Description:
  Some cool description

# This is a comment and this below creates an binary program    
Executable &lt;some_program_name&gt;
  Path: src
  BuildTools:ocamlbuild
  install: true
  MainIs: main.ml
  CompiledObject: native
  BuildDepends: package_one, package_two

# Another comment, this builds a library called pg
Library pg
  Path:         src
  # oasis will figure out the dependencies, 
  # Just list the modules you want public, 
  # Note that there&#39;s no .ml, just give the name
  Modules:      Pg
  CompiledObject: byte
  BuildDepends: some_package</code></pre>
<p>5.4) Generate the Makefile, setup.ml, configure and other build crap.</p>
<pre class="shell"><code>$ oasis setup -setup-update dynamic</code></pre>
<p>5.5) Actually build your code, yes its just a call to make.</p>
<pre class="shell"><code>$ make</code></pre>
<p>5.6) You can stop here, but you can go even further with <code>oasis2opam</code>. Install it with: <code>opam install oasis2opam</code>, then in your project’s root directory, aka the directory with the _oasis file, do: <code>oasis2opam --local</code>. This creates the <code>opam</code> directory and some meta data for the opam packaging system. Your local package can now be a first class citizen with opam just by doing this in the same project root directory:</p>
<pre class="shell"><code>$ opam pin add &lt;your_package_name&gt; . -y</code></pre></li>
<li><p><code>merlin</code> is a OCaml program that is simply amazing it drives code completion for plugins available in <code>emacs</code> and <code>vim</code>. Once you have merlin installed and running, add a <code>.merlin</code> file to your project so that <code>merlin</code> knows what packages to code complete for, a sample <code>.merlin</code> file looks like this:</p>
<pre class="shell"><code>B _build/src
S src
PKG cmdliner js_of_ocaml</code></pre>
<p>Notice how I put the <code>B _build/src</code> That sort of assumes you’re using <code>_oasis</code> and you made the <code>src</code> directory I mentioned earlier.</p></li>
<li><p>There are no full blown IDEs for OCaml, learn <code>emacs</code> or <code>vim</code>. EDIT: apparently <code>Sublime Text</code> has a merlin plugin, if you’re already familiar with Sublime Text then just stick with it, merlin is really what matters here.</p></li>
<li><p><code>utop</code> is an enhanced repl, its better than the plain <code>ocaml</code> repl. Install it with <code>opam install utop</code></p></li>
</ol>
<h1 id="library-situation">Library situation</h1>
<p><code>OCaml</code> does have a standard library but it sucks. It was only created to serve the needs of the compiler programmers, ie its not like <code>Python</code>’s standard library which has everything under the sun + the moon. There are a few standard library replacements, one is called <code>Core</code> and its provided by Jane Street. Its the library used in the <strong>Real World OCaml</strong> book/website. Another standard library replacement is called <code>Batteries</code>, this is more “community” supported. There is a more recent contender called <code>Containers</code>. For a categorized list of contemporary and well liked/must have libraries, checkout the <a href="https://github.com/rizo/awesome-ocaml">awesome-ocaml</a> repository.</p>
<h1 id="speaking-of-libraries">Speaking of Libraries…</h1>
<p>This is “functional programming,” so many of the real world libraries you’ll encounter will have Monadic interfaces, like <code>lwt</code> or Core’s <code>async</code>, both are asynchronous threading libraries, use Monads and that wacky <code>&gt;&gt;=</code> function. But you really shouldn’t fret about what a Monad is or represents, just follow the type signature and you’ll be fine. For a more detailed treatment of Monads in OCaml and a code example to talk to the <code>Stripe</code> API, see <a href="http://hyegar.com/blog/2015/09/23/let&#39;s-just-use-monads/">this</a>.</p>
<h1 id="doing-simple-tasks-shameless-plug">Doing simple tasks (shameless plug)</h1>
<p>I try using <code>OCaml</code> for literally everything and that includes going to hackathons, to make this less painful I wrote a library called <code>Podge</code> which helps with simple stuff. I don’t claim its a standard library replacement, just a library for getting stuff done. These two code samples assume the file is named <code>code.ml</code> and can be run with <code>utop code.ml</code></p>
<p>First install with opam:</p>
<pre class="shell"><code>$ opam install podge</code></pre>
<ol style="list-style-type: decimal">
<li>Reading output of a process</li>
</ol>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="ot">#require &quot;podge&quot;</span>
<span class="kw">let</span> () = 
  Podge<span class="kw">.</span>Unix<span class="kw">.</span>read_process_output <span class="st">&quot;ls -halt&quot;</span> |&gt; List<span class="kw">.</span>iter print_endline</code></pre></div>
<p>The <code>|&gt;</code> just means piping, its piping the output of <code>read_process_output</code> into the input of the partially applied function <code>iter</code></p>
<ol style="list-style-type: decimal">
<li>Reading a file</li>
</ol>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="ot">#require &quot;podge&quot;</span>
<span class="kw">let</span> () = 
  Podge<span class="kw">.</span>Unix<span class="kw">.</span>read_lines <span class="st">&quot;code.ml&quot;</span> |&gt; List<span class="kw">.</span>iter print_endline</code></pre></div>
<p>Similar to 1, this reads all lines of file and gives it to the input of the partially applied function <code>iter</code>.</p>
<p>These are two simple code samples from <code>Podge</code>, check out the <a href="https://github.com/fxfactorial/podge">repo</a> for other useful modules like: (The README has code examples)</p>
<ol style="list-style-type: decimal">
<li><code>Web</code> for simple HTTP requests and getting data back as JSON,</li>
<li><code>Xml</code> for querying simple XML documents</li>
<li><code>ANSITerminal</code> for creating colored shell output</li>
<li><code>String</code> which is all due to <a href="http://rgrinberg.com">Rudi Grinberg</a>.</li>
</ol>
<h1 id="what-can-you-do-with-it">What can you do with it?</h1>
<p>Loads.</p>
<ol style="list-style-type: decimal">
<li>Compilers!, lots of compilers/compiler tools are written in OCaml: Facebook uses OCaml for <a href="https://github.com/facebook/pfff">pfff</a> and <a href="https://github.com/facebook/flow">flow</a> and the first cut of Rust was written in OCaml.</li>
<li>Financial world, <a href="https://www.janestreet.com">Jane Street</a> uses OCaml for basically everything (AFAIK)</li>
<li>Systems Programming: <a href="https://ahrefs.com">ahrefs</a>, my employer, uses OCaml for heavy systems programming.</li>
<li>Kernels: Unikernels are hot right now, the most prominent one is the <a href="https://mirage.io">Mirage-OS</a> project and its all OCaml.</li>
<li>Shameless plug: I use OCaml as well for <code>js_of_ocaml</code>, in fact I’m using it to write an Electron app with a node backend (All code is OCaml compiled into JS, then run on node/Electron), see <a href="https://github.com/fxfactorial/ocaml-electron">here.</a></li>
<li>Genomics/Bioinformatics: <a href="https://github.com/hammerlab">Hammer Lab</a> in NYC uses OCaml for their genomics/sequencing work.</li>
</ol>
<p>…And I’m sure there’s more I haven’t mentioned…</p>
<h1 id="stick-with-it">Stick with it!</h1>
<p>This style of coding might be new to you or maybe its your first programming language, stick with it and continue. <code>OCaml</code> offers many awesome features and has many strengths including a very professional and pragmatic community.</p>]]></description>
    <pubDate>Tue, 20 Oct 2015 00:00:00 UT</pubDate>
    <guid>http://beancode.io/2015/10/20/so-youre-learning-ocaml/index.html</guid>
    <dc:creator>Edgar Aroutiounian</dc:creator>
</item>
<item>
    <title>2015-10-12-monads-you-can-understand</title>
    <link>http://beancode.io/2015/10/12/monads-you-can-understand/index.html</link>
    <description><![CDATA[<p>Let’s learn about monads as programmers, that is let’s use them for building something and in the process we’ll build up a intuition; practice first, then you can go back to theory later.</p>
<p>This post is split in two parts:</p>
<p>Part 1 is just to get the ideas out the door</p>
<p>Part 2 (Currently not written) is for an OCaml audience, just to improve the quality of the OCaml code itself</p>
<p>As Bryan O’Sullivan said (From Real World Haskell) “…we need something that’s non-trivial but still chewey.” So we’ll build a real working example in OCaml that will be the starting point of a library to the <a href="https://stripe.com/docs/api">Stripe API</a> and it will use monads.</p>
<h1 id="prereqs">Prereqs</h1>
<p>We need to make sure we have all the same starting point for this code, I assume you have <a href="https://opam.ocaml.org">opam</a> installed. Now do:</p>
<pre class="shell"><code>$ opam install lwt cohttp yojson uri</code></pre>
<p>These are the libaries we will use: <code>lwt</code> is for threading, <code>cohttp.lwt</code> is for our HTTP requests, <code>uri</code> for handling URIs and <code>yojson</code>, an easy to use and <strong>de facto</strong> json library.</p>
<h1 id="stripe">Stripe</h1>
<p>The Stripe API is a straight forward REST API. You’ll need to have a developer account from which you’ll get your Test Key, hence forth known as <code>key</code>. We’ll focus on one task, we’ll start the process of charging a credit card. Point your browser to this <a href="https://stripe.com/docs/api#create_charge">link</a> which shows how to create the “Charge” object. Be sure to be looking at that page while logged in because we’ll need the value for the <code>source</code> parameter, we’ll call it the <strong>source token</strong> From there we see we need to do a <code>POST</code> to <a href="https://api.stripe.com/v1/charges" class="uri">https://api.stripe.com/v1/charges</a> with several required arguments:</p>
<ol style="list-style-type: decimal">
<li>The amount to charge</li>
<li>The ISO code for currency</li>
<li>Either the Customer or Source</li>
</ol>
<p>All of Stripe’s API returns JSON, so we can already sketch out our function’s signature and helper data structure, something like:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">type</span> t = { authed : Cohttp<span class="kw">.</span>Headers<span class="kw">.</span>t; 
           end_point : <span class="dt">string</span>; }

<span class="kw">val</span> make_handle : <span class="dt">unit</span> -&gt; t

<span class="kw">val</span> create_charge : <span class="dt">int</span> -&gt; 
                    <span class="dt">string</span> -&gt; 
                    <span class="dt">string</span> -&gt;
                    t -&gt;  
                    Yojson<span class="kw">.</span>Basic<span class="kw">.</span>json Lwt<span class="kw">.</span>t</code></pre></div>
<p>Mostly straight forward, although that <code>Lwt.t</code> should look at little strange. The quick answer that that <code>create_charge</code> will give back an <code>Lwt.t</code> monad which in this case will contain a <code>json</code> object.</p>
<p>Let’s start filling out the <code>make_handle</code> function,</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">let</span> make_handle () = 
  <span class="kw">let</span> auth_me k = 
    <span class="kw">let</span> starter = Cohttp<span class="kw">.</span>Header<span class="kw">.</span>init () <span class="kw">in</span> 
    Cohttp<span class="kw">.</span>Auth<span class="kw">.</span>credential_of_string (<span class="st">&quot;Bearer &quot;</span> ^ k)
    |&gt; Cohttp<span class="kw">.</span>Header<span class="kw">.</span>add_authorization starter
  <span class="kw">in</span>
  {authed = auth_me <span class="st">&quot;YOUR STRIPE KEY&quot;</span>; 
   <span class="co">(** Hardcoding to the charge create path *)</span>
   end_point = <span class="st">&quot;https://api.stripe.com/v1/charges&quot;</span>}</code></pre></div>
<p>This creates our record needed for making a post. Stripe requires a key in each request so we’ll make this record to encapsulate that, otherwise we have to write boilerplate code, never fun.</p>
<p>Now the first cut of out <code>create_charge</code> function:</p>
<p>(<strong>META NOTE</strong> This is horrible indentation, I’m only doing it because of the sizing done in the exporting of this document and I want it to be clear what’s happening and the coloring is wrong because <sub>’</sub> can be used in a value’s name but its messing up the coding exporter)</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"> <span class="dv">1</span>  <span class="kw">let</span> create_charge amount currency source handle = 
 <span class="dv">2</span>    <span class="kw">let</span> <span class="ot">open</span> Cohttp_lwt_unix <span class="kw">in</span>
 <span class="dv">3</span>    <span class="kw">let</span> this_uri = Uri<span class="kw">.</span>of_string handle.end_point <span class="kw">in</span>
 <span class="dv">4</span>    [(<span class="st">&quot;amount&quot;</span>, string_of_int amount);
 <span class="dv">5</span>     (<span class="st">&quot;currency&quot;</span>, currency);]
 <span class="dv">6</span>     (<span class="st">&quot;source&quot;</span>, source)]
 <span class="dv">7</span>    |&gt; Uri<span class="kw">.</span>add_query_params&#39; this_uri
 <span class="dv">8</span>    |&gt; Client<span class="kw">.</span>post ~headers:handle.authed &gt;&gt;= 
 <span class="dv">9</span>       <span class="kw">fun</span> (resp, body) -&gt; 
<span class="dv">10</span>       <span class="co">(* This can also be done more succinctly</span>
<span class="co">11          with:</span>
<span class="co">12          Cohttp_lwt_body.to_string body &gt;|=</span>
<span class="co">13          Yojson.Basic.from_string  *)</span>
<span class="dv">14</span>       Cohttp_lwt_body<span class="kw">.</span>to_string body &gt;&gt;= <span class="kw">fun</span> j -&gt; 
<span class="dv">15</span>       Yojson<span class="kw">.</span>Basic<span class="kw">.</span>from_string j |&gt; return</code></pre></div>
<p>Okay, so what the hell is going on. Line 2 open the <code>Cohttp_lwt_unix</code> module locally to this function so that we can type <code>Client.post</code> instead of <code>Cohttp_lwt_unix.Client.post</code>. Line 3 creates a <code>uri</code> object, lines 4-6 are the query parameters we want to add to our <code>uri</code> object. The <code>|&gt;</code> symbol is a function, you can call it reverse apply, you can define it as</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">let</span> ( |&gt; ) f x = x f</code></pre></div>
<p>but you don’t need to, it comes with OCaml. It just says take the left side as the input to the right side, aka a Unix Pipe. Now let’s see the signature of <code>Client.post</code>, its:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> post ?ctx:Cohttp_lwt_unix<span class="kw">.</span>Client<span class="kw">.</span>ctx -&gt;
         ?body:Cohttp_lwt_body<span class="kw">.</span>t -&gt;
         ?chunked:<span class="dt">bool</span> -&gt;
         ?headers:Cohttp<span class="kw">.</span>Header<span class="kw">.</span>t -&gt;
         Uri<span class="kw">.</span>t -&gt; 
         (Cohttp<span class="kw">.</span>Response<span class="kw">.</span>t * Cohttp_lwt_body<span class="kw">.</span>t) Lwt<span class="kw">.</span>t</code></pre></div>
<p>Looks big but we don’t care about most of it, in fact we could just care about the <code>Uri.t</code> parameter since the rest of the parameters, the ones with <code>?</code>, have default values but we can override them as we do on line 8’s <code>Client.post ~headers:handle.authed</code>. Now notice the final value of a call to <code>Client.post</code>, its:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml">(Cohttp<span class="kw">.</span>Response<span class="kw">.</span>t * Cohttp_lwt_body<span class="kw">.</span>t) Lwt<span class="kw">.</span>t</code></pre></div>
<p>This says that <code>post</code> will give back an <code>Lwt.t</code> monad which contains a tuple of a response object and the body, again completely reasonable. The line of line 8 features the famous <code>&gt;&gt;=</code> operator, aka <code>bind</code> it’s signature is:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> ( &gt;&gt;= ) : &#39;a Lwt<span class="kw">.</span>t -&gt; (&#39;a -&gt; &#39;b Lwt<span class="kw">.</span>t) -&gt; &#39;b Lwt<span class="kw">.</span>t</code></pre></div>
<p>And this says that <code>&gt;&gt;=</code> takes something wrapped in the <code>Lwt.t</code> monad on the left side and passes the unwrapped value to a function on the right side which has to return something wrapped in the <code>Lwt.t</code> monad where the two somethings can be different or the same. So in our code that right side is this anonymous function, this lambda:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">fun</span> (resp, body) -&gt;</code></pre></div>
<p>Now we have a handle on the http response and the body, we won’t do any error checking so let’s just look at the body with line 10’s usage of <code>Cohttp_lwt_body.to_string</code> whose signature is:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> to_string : Cohttp_lwt_body<span class="kw">.</span>t -&gt; <span class="dt">string</span> Lwt<span class="kw">.</span>t</code></pre></div>
<p>Translation: Takes a body and gives back a string wrapped in a Lwt.t monad. Remember our goal is to get the body as a json object, so we could just pipe it to <code>Yojson.Basic.from_string</code> but still recall that our <code>create_charge</code> function had final value of <code>Yojson.Basic.json Lwt.t</code>, not a plain <code>Yojson.Basic.json</code> so we pipe it to the other famous monad related function, <code>return</code>. <code>return</code> really should have been called inject because it takes a plain value and “injects” it into a monad, let’s see its value here:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">val</span> return : &#39;a -&gt; &#39;a Lwt<span class="kw">.</span>t</code></pre></div>
<p>We are using it to turn our plain <code>Yojson.Basic.json</code> into a <code>Yojson.Basic.json Lwt.t</code> Now let’s use this code to actually do something.</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">let</span> program = 
  <span class="kw">let</span> this_handle = make_handle () <span class="kw">in</span>
  <span class="kw">let</span> st = <span class="st">&quot;SOURCE_TOKEN_MENTIONED_EARLIER&quot;</span> <span class="kw">in</span>
  create_charge <span class="dv">500</span> <span class="st">&quot;usd&quot;</span> this_handle &gt;&gt;= <span class="kw">fun</span> j -&gt; 
  Yojson<span class="kw">.</span>Basic<span class="kw">.</span>pretty_to_string j |&gt; Lwt_io<span class="kw">.</span>printl 

<span class="kw">let</span> () = 
  Lwt_main<span class="kw">.</span>run program</code></pre></div>
<p>At this point this should be understandable, our create_charge is returning a monad so we pass its output to <code>&gt;&gt;=</code>, which passes a json object to a lambda, we turn the json value to a pretty printed string and pipe it out to <code>Lwt_io.printl</code>, a <code>printf</code> for the <code>Lwt</code> library.</p>
<h1 id="build-and-run">Build and Run</h1>
<p>Now let’s build our program and run it, assuming all the code is in <code>code.ml</code> we invoke the OCaml toolchain as so:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml">$ ocamlfind ocamlopt -linkpkg code.ml -packages lwt.unix,cohttp.lwt,yojson,uri -o <span class="dt">T</span></code></pre></div>
<p>assuming everything well, you should have an executable T, which will print something like:</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml">$ ./<span class="dt">T</span>
{
  <span class="st">&quot;object&quot;</span>: <span class="st">&quot;charge&quot;</span>,
  <span class="st">&quot;created&quot;</span>: <span class="dv">1443072037</span>,
  <span class="st">&quot;livemode&quot;</span>: <span class="kw">false</span>,
  <span class="st">&quot;paid&quot;</span>: <span class="kw">true</span>,
  <span class="st">&quot;status&quot;</span>: <span class="st">&quot;succeeded&quot;</span>,
  <span class="st">&quot;amount&quot;</span>: <span class="dv">500</span>,
  <span class="st">&quot;currency&quot;</span>: <span class="st">&quot;usd&quot;</span>,
  <span class="st">&quot;refunded&quot;</span>: <span class="kw">false</span>,
  <span class="st">&quot;source&quot;</span>: {
    <span class="st">&quot;object&quot;</span>: <span class="st">&quot;card&quot;</span>,
    <span class="st">&quot;brand&quot;</span>: <span class="st">&quot;Visa&quot;</span>,
    <span class="st">&quot;funding&quot;</span>: <span class="st">&quot;credit&quot;</span>,
    <span class="st">&quot;exp_month&quot;</span>: <span class="dv">8</span>,
    <span class="st">&quot;exp_year&quot;</span>: <span class="dv">2016</span>,
    <span class="st">&quot;country&quot;</span>: <span class="st">&quot;US&quot;</span>,
    <span class="st">&quot;name&quot;</span>: null,
    <span class="st">&quot;address_line1&quot;</span>: null,
    <span class="st">&quot;address_line2&quot;</span>: null,
    <span class="st">&quot;address_city&quot;</span>: null,
    <span class="st">&quot;address_state&quot;</span>: null,
    <span class="st">&quot;address_zip&quot;</span>: null,
    <span class="st">&quot;address_country&quot;</span>: null,
    <span class="st">&quot;cvc_check&quot;</span>: null,
    <span class="st">&quot;address_line1_check&quot;</span>: null,
    <span class="st">&quot;address_zip_check&quot;</span>: null,
    <span class="st">&quot;tokenization_method&quot;</span>: null,
    <span class="st">&quot;dynamic_last4&quot;</span>: null,
    <span class="st">&quot;metadata&quot;</span>: {},
    <span class="st">&quot;customer&quot;</span>: null
  },
  <span class="st">&quot;captured&quot;</span>: <span class="kw">true</span>,
  <span class="st">&quot;failure_message&quot;</span>: null,
  <span class="st">&quot;failure_code&quot;</span>: null,
  <span class="st">&quot;amount_refunded&quot;</span>: <span class="dv">0</span>,
  <span class="st">&quot;customer&quot;</span>: null,
  <span class="st">&quot;invoice&quot;</span>: null,
  <span class="st">&quot;dispute&quot;</span>: null,
  <span class="st">&quot;metadata&quot;</span>: {},
  <span class="st">&quot;statement_descriptor&quot;</span>: null,
  <span class="st">&quot;fraud_details&quot;</span>: {},
  <span class="st">&quot;receipt_email&quot;</span>: null,
  <span class="st">&quot;receipt_number&quot;</span>: null,
  <span class="st">&quot;shipping&quot;</span>: null,
  <span class="st">&quot;destination&quot;</span>: null,
  <span class="st">&quot;application_fee&quot;</span>: null,
  <span class="st">&quot;refunds&quot;</span>: {
    <span class="st">&quot;object&quot;</span>: <span class="st">&quot;list&quot;</span>,
    <span class="st">&quot;total_count&quot;</span>: <span class="dv">0</span>,
    <span class="st">&quot;has_more&quot;</span>: <span class="kw">false</span>,
    <span class="st">&quot;url&quot;</span>: <span class="st">&quot;/v1/charges/ch_16oS9pJDURztdKY9Z7QS8c8D/refunds&quot;</span>,
    <span class="st">&quot;data&quot;</span>: []
  }
}</code></pre></div>
<p>Yay success.</p>
<h1 id="moral-of-the-story">Moral of the Story</h1>
<p>So in terms of actually day to day coding, you don’t actually need to know what a monad “is”, you just need to know how to use it and honestly that’s completely fine, in fact just following the type signatures can take you pretty far in a new, unfamiliar library.</p>]]></description>
    <pubDate>Mon, 12 Oct 2015 00:00:00 UT</pubDate>
    <guid>http://beancode.io/2015/10/12/monads-you-can-understand/index.html</guid>
    <dc:creator>Edgar Aroutiounian</dc:creator>
</item>
<item>
    <title>2015-10-07-elegant</title>
    <link>http://beancode.io/2015/10/07/elegant/index.html</link>
    <description><![CDATA[<p>I love elegant code, code that just flows and lets you “see” how the data moves through execution. As part of my <a href="https://github.com/fxfactorial/brozip">brozip</a> application, I wanted to give the feature of recursively compressing or decompressing a directory. So I just wrote exactly what came to mind and came up with this</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="kw">let</span> <span class="kw">rec</span> walk_and_action action node =
  <span class="kw">if</span> Sys<span class="kw">.</span>is_directory node
  <span class="kw">then</span> (Sys<span class="kw">.</span>readdir node
        |&gt; Array<span class="kw">.</span>to_list
        |&gt; List<span class="kw">.</span>map (Filename<span class="kw">.</span>concat node)
        |&gt; Lwt_list<span class="kw">.</span>iter_p (walk_and_action action))
  <span class="kw">else</span> action node</code></pre></div>
<p>Where <code>action</code> has type: <code>string -&gt; unit Lwt.t</code> (a function that takes a <code>string</code> and returns <code>unit Lwt.t</code>) and <code>node</code> is just a <code>string</code> for the file name. Translating the code into English, we first check if the file name represents a directory, if its a directory then we</p>
<blockquote>
<ol style="list-style-type: decimal">
<li>Read the directory’s contents</li>
<li>Convert the returned array into a list</li>
<li>Use a partially evaluated function, <code>Filename.concat node</code> and finish that computation for each of the file names in the list</li>
<li>Use correct concatenated strings to feed to <code>Lwt_list.iter_p</code> which will call the partially evaluated function <code>walk_and_action action</code> on each of the files. The <code>iter_p</code> function tells us that it will call its given function concurrently, which is very nice.</li>
</ol>
</blockquote>
<p>If its not a directory then we just call the function for the given file.</p>
<p>Notice how elegant this code is, the whole function body is just one expression and the data just flows from the output of one function as the input of the other, there’s no separation between the function calls.</p>]]></description>
    <pubDate>Wed, 07 Oct 2015 00:00:00 UT</pubDate>
    <guid>http://beancode.io/2015/10/07/elegant/index.html</guid>
    <dc:creator>Edgar Aroutiounian</dc:creator>
</item>
<item>
    <title>2015-09-21-ocaml-love</title>
    <link>http://beancode.io/2015/09/21/ocaml-love/index.html</link>
    <description><![CDATA[<p>Programmers usually have a choice of language to use via what job they decide to seek. Its probably the case that the majority of programmers don’t really care what language they use and really just care about the paycheck and this is pretty much fine I think, at the end of the day it really is just a job. That said there are indeed some programmers that care about what language they use for the majority of their adult waking life, I liken it to a carpenter caring about the brand of hammers they’re using.</p>
<h1 id="my-choice">My choice</h1>
<p>For me the best language to use is <a href="http://ocaml.org">OCaml</a>. Its a statically typed functional programming language that has a powerful type system. In addition to being a functional language, OCaml lets me write imperative code with real mutation and this is often very useful, i.e having a local reference variable really makes some code so much cleaner and easier to deal with and that really ought to be our goal, clean and easy to reason about code.</p>
<h1 id="what-can-you-do-with-it">What can you do with it?</h1>
<p>I keep getting this question and its a little strange. What can I do with this language? Well anything else you can do in any other programming language. For me I’m working in the day-time as an OCamler and I use it for my <a href="https://github.com/fxfactorial">personal projects</a>. I even write JavaScript in OCaml via <a href="http://ocsigen.org/js_of_ocaml/">js_of_ocaml</a>.</p>
<p>Here’s an example straight from my bindings to <a href="https://github.com/maxmind/libmaxminddb">libmaxminddb</a>.</p>
<div class="sourceCode"><pre class="sourceCode ocaml"><code class="sourceCode ocaml"><span class="co">(* File named loc_dump.ml *)</span>
<span class="ot">#require &quot;maxminddb&quot;</span>

<span class="kw">let</span> () =
  <span class="kw">let</span> some_ip = <span class="st">&quot;172.56.31.240&quot;</span> <span class="kw">in</span>
  <span class="kw">let</span> this_mmdb = Maxminddb<span class="kw">.</span>create <span class="st">&quot;etc/GeoLite2-City.mmdb&quot;</span> <span class="kw">in</span>
  <span class="kw">let</span> loc = Maxminddb<span class="kw">.</span>location some_ip this_mmdb <span class="kw">in</span>
  <span class="kw">let</span> <span class="ot">open</span> Maxminddb <span class="kw">in</span>
  Printf<span class="kw">.</span>sprintf <span class="st">&quot;%f %f %d %s&quot;</span> loc.latitude loc.longitude loc.metro_code loc.time_zone
  |&gt; print_endline;
  <span class="kw">let</span> geo_borders = borders ~lang:<span class="dt">French</span> ~ip:some_ip this_mmdb <span class="kw">in</span>
  Printf<span class="kw">.</span>sprintf
    <span class="st">&quot;%s %s %s %s %s&quot;</span>
    geo_borders.postal_code
    geo_borders.city_name
    geo_borders.country_name
    geo_borders.continent_name
    geo_borders.iso_code
  |&gt; print_endline</code></pre></div>
<p>And the corresponding result on the shell</p>
<pre class="shell"><code>$ utop loc_dump.ml
33.895900 -118.220100 803 America/Los_Angeles
90221 Compton États-Unis Amérique du Nord US</code></pre>
<p>In any case if you’re a programmer and reading this post then I recommend that you try OCaml, especially if you have been burned by Haskell’s mental overhead but still want to do functional programming.</p>]]></description>
    <pubDate>Mon, 21 Sep 2015 00:00:00 UT</pubDate>
    <guid>http://beancode.io/2015/09/21/ocaml-love/index.html</guid>
    <dc:creator>Edgar Aroutiounian</dc:creator>
</item>
<item>
    <title>2015-09-17-healthcare</title>
    <link>http://beancode.io/2015/09/17/healthcare/index.html</link>
    <description><![CDATA[<p>My dad lives in Florida and isn’t too well off. So much so that since the early part of this year I’ve been paying for his health insurance, its the first time he has ever had regular healthcare since leaving the Soviet Union in 1993.</p>
<h1 id="getting-healthcare">Getting healthcare</h1>
<p>Because it was for an individual and I was handling everything, I had to use healthcare.gov. This is like two years since the site had been up, I think, so I presumed all the bugs had been hashed out or at least the easy ones (my dad’s application was basically the simplest one out there). Hint, the site still had bugs and didn’t actually work on Chrome. (What amazing things a startup could have done with $300 million)</p>
<p>We discovered he had prostate cancer and he underwent surgery on the 31st of August. I was relieved and glad that I was taking care of my dad, the bill was on autopay and he was doing well. A few days later I got a call from my dad saying his insurance was canceled, very strange to me since I already paid that month’s bill.</p>
<h1 id="no-one-takes-responsibility">No one takes responsibility</h1>
<p>So I called Florida Blue, being in San Francisco that three hour time difference can be annoying. Florida Blue told me that the Marketplace, aka healthcare.gov, terminated the plan. That was immediately strange to me as the Marketplace never asked me whether I wanted the plan canceled. I called the Marketplace and they told me they never canceled the plan and subsequently told me to call Florida Blue; you can see how this is getting aggravating. The Marketplace then told me they would assign a case worker to this and of course it would take up to 30 days, 30 days to do what is essentially some SQL queries and other record lookups. Of course I’m having to waste many hours on the phone and explain this all over to my dad. I think I’ve said my name and requested authorization to speak on dad’s behalf about sixteen times already.</p>
<h1 id="wait-a-month">Wait a Month</h1>
<p>So now my dad, who underwent surgery on the 31st of August, has no insurance for the entire month of September. All his followup doctor visits, medications are canceled. He has to wait until October 1st until the insurance is reinstated all because of the incompetence of a third party that forcibly injected itself into the patient-doctor realm.</p>
<h1 id="something-to-be-said">Something to be said</h1>
<p>My dad grew up in the Soviet Union so everything that he knew was ultimately state owned, both physically and intellectually. But he said the following to me,</p>
<blockquote>
<p>Why is the government involved between me and the doctors, or the insurance company we choose?</p>
</blockquote>
<p>And it stuck to me because I also believe that, every experience we’ve had with the government is bad or a waste of time and its why I’m suspicious of white leftists espousing the wisdom of “if we only spent more money on <their favorite moral issue>…” Thought-experiments and ideas need to hit reality at some point, its similar to why I like Silicon Valley and open source coding; the idea should be good but the implementation is more important. In any case the point I want to make is simple: <strong>Healthcare.gov still sucks.</strong></p>]]></description>
    <pubDate>Thu, 17 Sep 2015 00:00:00 UT</pubDate>
    <guid>http://beancode.io/2015/09/17/healthcare/index.html</guid>
    <dc:creator>Edgar Aroutiounian</dc:creator>
</item>
<item>
    <title>2015-09-11-linux</title>
    <link>http://beancode.io/2015/09/11/linux/index.html</link>
    <description><![CDATA[<h1 id="tags">Tags</h1>
<p>If you are using etags, stop doing that. The best tag system is gnu global, it is simply amazing. If you are on a debian machine, I recommend getting <a href="http://www.gnu.org/software/global/download.html">gnu global</a> from sourc hand. The reason is that the version of gnu global on apt-get is incredibly outdated. Once you have it installed, go to the root of your linux, or any C project, directory and type <code>gtags</code>. This will create all the infrastructure that we will soon be using in emacs. Note that the gtags file for Linux takes a few moments and clocks in at about 100mb, this is Linux source code after all…</p>
<h1 id="emacs-side">Emacs Side</h1>
<p>Now that we have gtags up and running, we can now focus on the emacs portion of things. Here’s my hook for C-mode in emacs:</p>
<pre class="emacs-lisp"><code>(add-hook &#39;c-mode-hook &#39;(lambda ()
                          (setq-local show-trailing-whitespace t)
                          (semantic-mode)
                          (auto-complete-mode -1)
                          (company-mode)
                          (global-set-key (kbd &quot;C-c C-f&quot;) &#39;helm-command-prefix)
                          (global-unset-key (kbd &quot;C-x c&quot;))
                          (define-key helm-gtags-mode-map (kbd &quot;M-s&quot;) &#39;helm-gtags-select)
                          (setq helm-quick-update                     t ; do not display invisible candidates
                                helm-split-window-in-side-p           t ; open helm buffer inside current window, not occupy whole other window
                                helm-buffers-fuzzy-matching           t ; fuzzy matching buffer names when non--nil
                                helm-move-to-line-cycle-in-source     t ; move to end or beginning of source when reaching top or bottom of source.
                                helm-ff-search-library-in-sexp        t ; search for library in `require&#39; and `declare-function&#39; sexp.
                                helm-scroll-amount                    8 ; scroll 8 lines other window using M-&lt;next&gt;/M-&lt;prior&gt;
                                helm-ff-file-name-history-use-recentf t
                                helm-gtags-ignore-case t
                                helm-gtags-auto-update t
                                helm-gtags-use-input-at-cursor t
                                helm-gtags-pulse-at-cursor t
                                helm-gtags-prefix-key &quot;\C-cg&quot;
                                helm-gtags-suggested-key-mapping t)
                          (helm-gtags-mode)
                          (define-key helm-gtags-mode-map (kbd &quot;M-.&quot;) &#39;helm-gtags-dwim)
                          (define-key helm-gtags-mode-map (kbd &quot;M-,&quot;) &#39;helm-gtags-pop-stack)
                          ;;Too complex for me right now. 
                          ;;(helm-mode)
                          (define-key company-mode-map (kbd &quot;M-h&quot;) &#39;company-c-headers)
                          (hs-minor-mode)
                          (define-key hs-minor-mode-map (kbd &quot;C-c C-t&quot;) &#39;hs-toggle-hiding)
                          (define-key c-mode-map (kbd &quot;C-c C-c&quot;) &#39;compile)
                          (semantic-mru-bookmark-mode)
                          (define-key semantic-mode-map (kbd &quot;M-]&quot;) &#39;semantic-ia-fast-jump)
                          (define-key semantic-mode-map (kbd &quot;M-[&quot;) &#39;semantic-ia-fast-jump-back)
                          (define-key c-mode-map (kbd &quot;C-c C-i&quot;) &#39;default-c-includes)
                          (ggtags-mode)
                          (define-key ggtags-mode-map (kbd &quot;M-.&quot;) nil)
                          (define-key ggtags-mode-map (kbd &quot;M-&lt;&quot;) nil)
                          (define-key ggtags-mode-map (kbd &quot;M-&gt;&quot;) nil)
                          (define-key ggtags-mode-map (kbd &quot;M-n&quot;) nil)
                          (define-key ggtags-mode-map (kbd &quot;M-p&quot;) nil)
                          (define-key ggtags-mode-map (kbd &quot;M-,&quot;) nil)
                          (define-key ggtags-mode-map (kbd &quot;M-]&quot;) nil)
                          (define-key ggtags-mode-map (kbd &quot;M--&quot;) &#39;ggtags-find-reference)
                          ;;Flycheck has issues with tramp, just FYI. 
                          ;;(flycheck-mode)
                          (linux-c-mode)))</code></pre>
<p>That’s quite a bit, but I’ll explain all the relevant parts. I don’t really use helm, other than for the features of <code>helm-gtags-dwin</code> and <code>helm-gtags-pop-stack</code> simply because Helm is too big for my tastes and it goes against how most of emacs “does” things. Basically whenever I want to find where a struct, function, etc is defined, I can just hit <code>M-.</code> and gtags will take me there, if I want to come back to where I was before looking up the definition, then I hit M-,. The reader might notice that I define many of the keys from <code>ggtags-mode-map</code> to <code>nil</code>, this is because the keys conflicted with my desired key bindings and the only thing that I found of use from ggtags-mode was finding all the references made to a piece of code, this is via the <code>ggtags-find-reference</code> function. This is a feature that Semantic can supposedly do, but getting it to work right with the remote machine and the messed up header paths was just too much work, plus it had some issues about <code>call-process</code>. Ggtags-mode is able to do this incredibly well and fast. Finally there is the call to <code>linux-c-mode</code>, that is simply defined as:</p>
<pre class="emacs-lisp"><code>(defun linux-c-mode ()
  &quot;C mode with adjusted defaults for use with the linux kernel.&quot;
  (interactive)
  (setq c-set-style &quot;linux&quot;)
  (setq c-brace-offset -8)
  (setq c-default-style &quot;linux&quot;)
  (setq c-basic-offset 8)
  (setq tab-width 8))</code></pre>
<p>Since our homework assignments had Linux’s <code>checkpatch.pl</code> script run against them, it made sense to just start out with Linux style C-coding enforced in emacs itself.</p>
<h1 id="wrapping-up">Wrapping up</h1>
<p>That’s basically it. I skipped over a few things, but if you have questions, feel free to ask in the comments and I’ll try to answer them. For reference, my <code>init.el</code> is [[<a href="https://github.com/fxfactorial/emacsd/blob/m" class="uri">https://github.com/fxfactorial/emacsd/blob/m</a> other goodies.</p>]]></description>
    <pubDate>Fri, 11 Sep 2015 00:00:00 UT</pubDate>
    <guid>http://beancode.io/2015/09/11/linux/index.html</guid>
    <dc:creator>Edgar Aroutiounian</dc:creator>
</item>
<item>
    <title>2015-09-11-cool-latex</title>
    <link>http://beancode.io/2015/09/11/cool-latex/index.html</link>
    <description><![CDATA[<p>This post is going to add a lot of value to your life; I’m going to show you how to:</p>
<ol style="list-style-type: decimal">
<li>Install LaTeX on OS X, without too much junk.</li>
<li>Use org-mode on emacs along with some creature comforts</li>
<li>Use animations inside a PDF. Yes, I’m serious.</li>
</ol>
<h1 id="installing-latex">Installing LaTeX</h1>
<p>Most folks that install LaTeX on OS X probably do it with the <a href="https://tug.org/mactex/">MacTex</a> package. This is probably fine for most people, but the trouble with MacTex is the size of the install; Its huge! The last time I checked, MacTex ended up using at least 1.5 <strong>gigabytes</strong>. That’s a lot of wasted space, especially for things like the LaTeX editor (since I do my LaTeX work in emacs). So here are the steps I recommend to installing LaTeX on OS X.</p>
<h2 id="installing-latex-on-os-x">Installing LaTeX on OS X</h2>
<ol style="list-style-type: decimal">
<li>If you already have MacTex installed, get rid of it. Its pretty simple, just follow the directions <a href="https://tug.org/mactex/uninstalling.html">here</a>.</li>
<li>Install BasicTex. This gives you stuff like pdfLatex, aka the compiler and core LaTeX. You can get the package installer from <a href="http://www.tug.org/mactex/morepackages.html">here</a>.</li>
<li>Download the Tex Live Utility from <a href="https://github.com/amaxwell/tlutility">here</a>. Tex Live Utility is your new LaTeX best friend. It will let you update all packages and install new ones whenever you need them, and you will need them since you only installed BasicTex. We will use it later on in this post.</li>
</ol>
<h1 id="org-mode">Org Mode</h1>
<p>I’m going to assume that you already know what emacs is, but I’ll explain org-mode. Org-mode is an amazing mode that lets your write notes, presentation, and more. Side note, these posts are written in org-mode. I write them in org-mode, then org-mode exports them to HTML; its pretty neat and convenient.</p>
<p>Okay, back to org-mode. In org-mode, you can put some configurations, things like:</p>
<pre class="org-mode"><code>#+AUTHOR: Edgar
#+LATEX_HEADER: \usepackage{lmodern}
#+OPTIONS: toc:nil</code></pre>
<p>Writing those things out on each new <code>.org</code> file is annoying. Fortunately emacs already comes with a solution. You’ll want to add this to your <code>init.el</code></p>
<pre class="emacs-lisp"><code>;; This turns on auto-insert-mode
(auto-insert-mode)
;; This turns off the prompt that auto-insert-mode asks before 
;; it actually inserts text/code for you
(setq auto-insert-query nil)
;; This is what you&#39;ll have inserted for a new .org file
(define-skeleton my-org-defaults
  &quot;Org defaults I use&quot;
  nil
  &quot;#+AUTHOR:   Your name\n&quot;
  &quot;#+EMAIL:    your.email@gmail.com\n&quot;
  &quot;#+LANGUAGE: en\n&quot;
  &quot;#+LATEX_HEADER: \\usepackage{lmodern}\n&quot;
  &quot;#+LATEX_HEADER: \\usepackage[T1]{fontenc}\n&quot;
  &quot;#+OPTIONS:  toc:nil num:0\n&quot;)
;; This is how to tell auto-insert what to use for .org files
(define-auto-insert &quot;\\.org\\&#39;&quot; &#39;my-org-defaults)</code></pre>
<p>Now whenever you open a new <code>.org</code> file, you’ll have these common things already there in the buffer. You can do this for other modes too, I do it for common <code>#include</code> items for C coding.</p>
<h1 id="writing-latex-via-org-mode">Writing LaTeX via org-mode</h1>
<p>You’ll notice that in <code>my-org-defaults</code>, I included some items for LaTeX. I used to write LaTeX in emacs by hand using Auctex and I actually still recommend newcomers to LaTeX start by writing it by hand. I use org-mode because the writing is so much easier in it, and I can always drop down to LaTeX whenever I need to, like when I need specific packages. For example, the <code>\usepackage{lmodern}</code> is a LaTeX package for really nice modern latin font. To get this package, you’ll need to install it via the newly installed Tex Live Utility application. Just open Tex Live Utility, go to the Packages tab, search for lmodern and right click and install.</p>
<p>To export the <code>.org</code> file to PDF, just do: <code>C-c C-e l p</code>, where that last <code>p</code> can be replaced with <code>o</code> to open the newly created PDF. Another neat thing in org mode that I like is seeing LaTeX before its a PDF, that is, I want to preview the LaTeX inside the buffer. This, assuming you already have <code>imagemagick</code> installed, is easily done with <code>C-c C-x C-l</code>.</p>
<p>Just to let you know my work-flow, I usually have a buffer open with the PDF of my work and another buffer of my <code>.org</code> file. Then I export to PDF and since I have <code>doc-view-mode</code> poll for updates, I see the changes to my work nearly instantly in the PDF buffer.</p>
<h1 id="animations-in-a-pdf">Animations in a PDF</h1>
<p>For a final paper on modifications to the <a href="http://en.wikipedia.org/wiki/Perceptron">Perceptron</a> algorithm, I wanted to include a neat animation of the Perceptron converging. Naturally I did my paper in emacs. Here are the steps needed.</p>
<ol style="list-style-type: decimal">
<li>Install the <code>animate</code> package using Tex Live Utility</li>
<li><p>Add the following two lines to your <code>.org</code> file.</p>
<pre class="org-mode"><code>#+LATEX_HEADER: \usepackage{animate}
#+LATEX_HEADER: \usepackage{graphics}</code></pre></li>
<li><p>For the place where you want to add the animation, add code like the following to your <code>.org</code> file:</p>
<pre class="tex"><code>\begin{center}
%                                            fps filename from to
  \animategraphics[autoplay, loop, width=4in]{2}{p_N200_it}{1}{68}
\end{center}</code></pre>
<p>In this example, I gave it some optional arguments and said use 2 frames per second and for all the filenames that start with p_N200_it, go from 1 to 68, for example <code>p_N200_it4.png</code>.</p>
<p><strong>Note:</strong> <code>\animategraphics</code> can take other optional arguments, like <code>controls</code>. Please sure to check out its easily googlable manual for all the details.</p></li>
</ol>
<p>After exporting the PDF, you’ll have a real animation that is completely self contained in the PDF.</p>
<p><strong>Note:</strong> The Preview.app on OS X is kind of crappy and doesn’t actually animate the graphic for reasons unknown to me, I recommend you use Adobe Reader.</p>
<p>I hope this post helps makes your papers all that more exciting and rewarding.</p>]]></description>
    <pubDate>Fri, 11 Sep 2015 00:00:00 UT</pubDate>
    <guid>http://beancode.io/2015/09/11/cool-latex/index.html</guid>
    <dc:creator>Edgar Aroutiounian</dc:creator>
</item>

    </channel>
</rss>
